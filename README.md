# Lead Manage System
Система управления лидами (обращениями) клиентов, заказавшим продвижение по модели CPA

## Требования
- [Docker](https://www.docker.com)
- [Docker Compose](https://docs.docker.com/compose/)
- [Composer](https://getcomposer.org)
- [Git](https://git-scm.com)

## [ Установка проекта ]

### 1. Склонировать репозиторий. 
```
    git clone git@git.isidea.ru:isidea/lms.git
```
или
```
    git clone https://git.isidea.ru/isidea/lms.git
```
В итоге создастся папка `lms` в текущей активной директории. Перейдем в эту папку:
```
    cd lms
```
### 2. Настроить конфигурационный файл.
```
    cp .env.example .env
```
В файле `.env` настраиваем следующие параметры:
```
    # название проекта
    APP_NAME="Lead Manage System"
    # текущее окружение
    APP_ENV=local
    # режим дебага
    APP_DEBUG=true
    # базовый урл приложения
    APP_URL=http://lms.local
    # порт приложения (докер)
    APP_PORT=80

    # порт базы данных (докер)
    DB_PORT=3306
    # данные для подключения к базе (в пределах докер контейнера)
    DB_DATABASE=lms
    DB_USERNAME=lms_user
    DB_PASSWORD=lms_pass

    # данные www-пользователя 
    WWWGROUP=1000
    WWWUSER=1000
```

### 3. Установка.
Выполнить сборку контейнеров и первоначальные настройки для приложения:
```
    make install
```
Если возникнут ошибки при выполнении этой команды, можно попробовать выполнить последовательность вручную поочередно (выполняемые операции описаны в `Makefile`).

_____
## [ Деплой проекта ]

Для разворачивания (запуска) проекта используем следующую команду:
```
    make run
```
Для сборки frontend части приложения выполняем следующий набор команд:
```
    make app_exec
    su - sail
    cd /var/www/html
    npm install
```
Для запуска frontend приложения на DEV (или локальной среде):
```
    npm run watch
```

Для запуска frontend приложения на продакшн среде:
```
    npm run prod
    exit
```
_____
:white_check_mark: <b>Все готово, проект запущен!</b> :+1: :tada:
_____

### Прочее
- Выполнение команд типа "artisan, php, composer, npm и так далее" можно производить либо через `vendor/bin/sail ...`, либо напрямую внутри контейнера.
- Для удобного использования Laravel Sail можно создать алиас для этой команды. Для этого нужно найти файл `.bash_aliases`, который обычно находится в корневой директории текущего юзера ОС (/home/{user}/...), и заполнить его следующим содержимым: `alias sail='bash vendor/bin/sail'`. Теперь вместо vendor/bin/sail можно использовать просто sail.
- Если в процессе возникли какие-либо ошибки, можно посмотреть логи, используя команды `make logs`, `make app_logs`, `make db_logs`
- Подключиться к базе данных: `make db_exec`
- Создать пользователя-администратора: `make create-admin`
- Выполнение оптимизации приложения (установка пакетов composer, применение миграций, сброс кеша): `make optimize`
- Посмотреть список и статус контейнеров: `make ps`
- Остановить все текущие активные контейнеры: `make stop`
- Полностью пересобрать (обновить + сброс кеша) контейнер приложения: `make build`
- Удалить все контейнеры и их данные (включая базу данных): `make remove`
